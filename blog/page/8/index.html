
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Ross Lawley</title>
  <meta name="author" content="Ross Lawley">

  
  <meta name="description" content="Tweet Day 2 - Gadget Fail Jan 2nd, 2011 Well after an long drive back down from the inlaws in Newcastle the family are back home and after watching &hellip;">
  

  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://rozza.github.com/blog/page/8/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Ross Lawley" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-716284-3']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body >
  <header role="banner" id="sidebar">
    <!-- Logo -->
<aside id="logo" class="clearfix">
  <div class="clearfix">
    <a href="/">Ross Lawley</a>
  </div>
</aside>

<ul id="menu">

  <li class="title">
    <h1 id="title"><a href="/">Ross Lawley</a></h1>
  </li>


  <li class="subtitle">
    <h2 id="subtitle">Some thoughts and musings</h2>
  </li>

  <li class="link">
    Python engineering evangelist and trainee triathlete!
  </li>

  <li class="link">
    <a href="http://twitter.com/RossC0/">twitter</a>
  </li>


  <li class="link">
    <a href="http://github.com/rozza/">github</a>
  </li>

  <li class="link rss">
    <a href="/atom.xml">rss feed</a>
  </li>
  
    <li>
    <form action="http://google.com/search" method="get">
      <fieldset role="search">
        <input type="hidden" name="q" value="site:rozza.github.com" />
        <input class="search" type="text" name="q" results="0" placeholder="Search"/>
      </fieldset>
    </form>
    </li>
    
</ul>



<!-- Octopress Love -->
<aside id="octopress_linkback">
  <a href="http://octopress.org/">
    <span class="unicode_square">
      <span class="unicode_circle">
        &nbsp;
      </span>
    </span>
    <span class="octopress">Powered by Octopress</span>
  </a>
</aside>

  </header>
  <section id="main">
      
  
  
    <article class="post">
      <div class="sharing-box">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://rozza.github.com/blog/page/8/index.html" data-via="RossC0" data-counturl="http://rozza.github.com/blog/page/8/index.html" data-size="large">Tweet</a>
  
  
  
</div>

      
  <header>
    
      <h2 class="entry-title">
        
        <a href="/day-2-gadget-fail/">Day 2 - Gadget Fail</a>
        
      </h2>
    
    
      <p class="meta">
        








  


<time datetime="2011-01-02T00:00:00+00:00" pubdate data-updated="true">Jan 2<span>nd</span>, 2011</time>
        
      </p>
    
  </header>


  <p>Well after an long drive back down from the inlaws in Newcastle the family are back home and after watching Downton Abbey, I remembered I hadn&#8217;t done any exercise today!</p>
<p>Earlier I had bought a cheap heart rate watch from Tescos; the idea being as I start training in ernest for my Triathlon in July, I need to know if I&#8217;m over training and stressing the body as apparently you will get ill, pick up extra injuries etc&#8230; So to do this I need to work out my resting heart rate and then each morning after waking take my rate and check it. &nbsp;If its too up, you need to rest up and recover - I&#8217;m not sure what &#8217;<em>too up</em>&#8217; is yet but I&#8217;ll get there!..</p>
<p>So my phone with Runkeeper (elite version now <strong>free</strong>&nbsp;for jan from the andriod store) had run out of batteries after using google navigation on the way home and I failed to start the stop watch on my new watch - so I guessed the time it took to do the lap.</p>
<p>Day two of Janathon done! &nbsp;Oh and the run was good.</p>
<p>&nbsp;</p>
<p><img class="posterous_download_image" src="http://maps.google.com/staticmap?size=150x150&amp;maptype=hybrid&amp;path=rgba:0xFF0000AF,weight:4%7C51.9926,-0.1804%7C51.9926,-0.1788%7C51.9926,-0.1761%7C51.9928,-0.1748%7C51.9929,-0.1742%7C51.9930,-0.1736%7C51.9932,-0.1724%7C51.9932,-0.1723%7C51.9930,-0.1721%7C51.9928,-0.1720%7C51.9928,-0.1720%7C51.9921,-0.1715%7C51.9914,-0.1712%7C51.9912,-0.1712%7C51.9912,-0.1712%7C51.9911,-0.1717%7C51.9911,-0.1717%7C51.9911,-0.1717%7C51.9910,-0.1720%7C51.9904,-0.1731%7C51.9901,-0.1740%7C51.9900,-0.1742%7C51.9900,-0.1742%7C51.9900,-0.1743%7C51.9900,-0.1745%7C51.9904,-0.1755%7C51.9905,-0.1761%7C51.9906,-0.1768%7C51.9904,-0.1778%7C51.9903,-0.1783%7C51.9904,-0.1788%7C51.9905,-0.1793%7C51.9909,-0.1797%7C51.9916,-0.1799%7C51.9921,-0.1804%7C51.9924,-0.1804%7C51.9924,-0.1804%7C51.9926,-0.1804" alt="" /></p>

  
  


    </article>
  
  
    <article class="post">
      <div class="sharing-box">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://rozza.github.com/blog/page/8/index.html" data-via="RossC0" data-counturl="http://rozza.github.com/blog/page/8/index.html" data-size="large">Tweet</a>
  
  
  
</div>

      
  <header>
    
      <h2 class="entry-title">
        
        <a href="/2011-and-janathon-begins/">2011 and Janathon Begins!</a>
        
      </h2>
    
    
      <p class="meta">
        








  


<time datetime="2011-01-01T00:00:00+00:00" pubdate data-updated="true">Jan 1<span>st</span>, 2011</time>
        
      </p>
    
  </header>


  <p>To celebrate the new year and to kick off <a href="http://www.janathon.com/">Janathon</a> in some sort of style I thought I&#8217;d join in the <a href="http://www.panamaswimmingclub.co.uk/products_6.html">Panama Swimming Clubs&#8217;</a> New Year Swim in Whitley Bay.</p>
<p>All I can say is it was COLD!&nbsp;The run back was easy enough and I slowly gained feeling back in my toes - which was a bonus! &nbsp;Word to the wise; never, I mean&nbsp;<strong><em>never&nbsp;</em></strong>run just in speedo swimming shorts - the inner net is like a cheese grater&#8230; &nbsp;You live and learn!</p>
<p>&nbsp;</p>
<p>[[posterous-content:afjaehfqkyiIDtfqsjbg]][[posterous-content:bDGEaApAczFvIItDxkhd]]</p>
<p><img class="posterous_download_image" src="http://maps.google.com/staticmap?size=150x150&amp;maptype=hybrid&amp;path=rgba:0xFF0000AF,weight:4%7C55.0509,-1.4488%7C55.0505,-1.4484%7C55.0502,-1.4480%7C55.0497,-1.4476%7C55.0494,-1.4473%7C55.0490,-1.4468%7C55.0487,-1.4465%7C55.0483,-1.4461%7C55.0481,-1.4468%7C55.0479,-1.4464%7C55.0475,-1.4457%7C55.0472,-1.4453%7C55.0468,-1.4447%7C55.0465,-1.4443%7C55.0461,-1.4438%7C55.0458,-1.4434%7C55.0454,-1.4429%7C55.0451,-1.4424%7C55.0448,-1.4419%7C55.0446,-1.4412%7C55.0443,-1.4406%7C55.0441,-1.4398%7C55.0440,-1.4393%7C55.0437,-1.4388%7C55.0432,-1.4385%7C55.0429,-1.4382%7C55.0426,-1.4376%7C55.0423,-1.4372%7C55.0420,-1.4365%7C55.0418,-1.4359%7C55.0417,-1.4353%7C55.0415,-1.4346%7C55.0414,-1.4340%7C55.0412,-1.4332%7C55.0409,-1.4326%7C55.0406,-1.4320%7C55.0403,-1.4322%7C55.0400,-1.4325%7C55.0395,-1.4328%7C55.0391,-1.4328%7C55.0386,-1.4326%7C55.0383,-1.4323%7C55.0379,-1.4327%7C55.0375,-1.4331%7C55.0372,-1.4329%7C55.0368,-1.4325%7C55.0365,-1.4322%7C55.0360,-1.4320%7C55.0357,-1.4323%7C55.0353,-1.4328%7C55.0350,-1.4330%7C55.0346,-1.4328%7C55.0341,-1.4326%7C55.0337,-1.4324%7C55.0332,-1.4322%7C55.0329,-1.4320%7C55.0325,-1.4316%7C55.0322,-1.4314%7C55.0318,-1.4311%7C55.0314,-1.4308%7C55.0310,-1.4309%7C55.0306,-1.4310%7C55.0305,-1.4315%7C55.0304,-1.4324%7C55.0303,-1.4330%7C55.0303,-1.4337%7C55.0299,-1.4340%7C55.0296,-1.4342%7C55.0294,-1.4350%7C55.0293,-1.4356%7C55.0291,-1.4364%7C55.0289,-1.4370" alt="" /></p>

  
  


    </article>
  
  
    <article class="post">
      <div class="sharing-box">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://rozza.github.com/blog/page/8/index.html" data-via="RossC0" data-counturl="http://rozza.github.com/blog/page/8/index.html" data-size="large">Tweet</a>
  
  
  
</div>

      
  <header>
    
      <h2 class="entry-title">
        
        <a href="/2010-locking-django-management-commands/">Locking Django Management Commands</a>
        
      </h2>
    
    
      <p class="meta">
        








  


<time datetime="2010-10-18T00:00:00+00:00" pubdate data-updated="true">Oct 18<span>th</span>, 2010</time>
        
      </p>
    
  </header>


  <p>I have a number of management commands running via cron and sometimes they take longer to run than the time imbetween jobs.  I don&#8217;t want two jobs runningin parallel so when I saw that <a href="http://github.com/jtauber/django-notification/">Django Notification</a>&nbsp;used lock files in its emission of notices, I wanted to apply that cleanly to my management commands.</p>
<p>So I created a decorator that would add a locking file based on the current module file name, which would ensure that there is only ever one process running at any time.  Then all I have to do is simply decorate my management commands by applying the decorator to the handle method like so:</p>
<p><code> </code></p>
<div class="CodeRay">
  <div class="code"><pre># load the deocrator
from decorators import handle_lock

class Command(BaseCommand):
    help = &quot;Regular Management command.&quot;

    # decorate the handle
    @handle_lock
    def handle(self, *args, **options):
        # Do your stuff here</pre></div>
</div>

<p><code> </code></p>
<p>&nbsp;</p>
<p>And volia the management command will only ever run in single file.  Go ahead and try it out:</p>
<p>&nbsp;</p>
<p><script src="https://gist.github.com/631953.js?file=decorator.py"></script></p>

  
  


    </article>
  
  
    <article class="post">
      <div class="sharing-box">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://rozza.github.com/blog/page/8/index.html" data-via="RossC0" data-counturl="http://rozza.github.com/blog/page/8/index.html" data-size="large">Tweet</a>
  
  
  
</div>

      
  <header>
    
      <h2 class="entry-title">
        
        <a href="/2010-resetting-south-migrations.html/">Resetting South Migrations</a>
        
      </h2>
    
    
      <p class="meta">
        








  


<time datetime="2010-09-28T00:00:00+00:00" pubdate data-updated="true">Sep 28<span>th</span>, 2010</time>
        
      </p>
    
  </header>


  <p><a href="http://south.aeracode.org/">South</a> migrations are great but over time, as you write more and more they can become unwieldy and slow. This is exactly what happened at <a href="http://www.streetbook.com/">Streetbook</a>, we love fast iterations and releasing often - the only downside was the number of migrations grew and grew to over a hundred. So we bit the bullet and reset them, it was less traumatic than I initially feared and we got the number of migrations down to just ten.  As I couldn&#8217;t find an easy step by step guide I thought I&#8217;d jot this down for others as a quick guide.</p>
<h2>Reseting migrations</h2>
<p>I found these steps allowed me to reset the migrations quickly and efficiently.  First with a fresh db run the existing migrations.  Then for each app:</p>
<ol>
<li>Export any created data: <br />
<div class="CodeRay">
  <div class="code"><pre>./manage.py dumpdata appname --indent=4 &gt; migration_data/app.json</pre></div>
</div>

</li>
<li>Delete the old migrations </li>
<li>Create the initial migration
<div class="CodeRay">
  <div class="code"><pre>./manage.py schemamigration appname --initial</pre></div>
</div>

</li>
<li>If needed, create a data migration for the app using either:
<ul>
<li>fixtures for large datasets</li>
<li>the south orm</li>
</ul>
</li>
</ol>
<h3>Migration Dependencies</h3>
<p>Once you&#8217;ve created all your new migrations run your test suite - its a great way to test the migration chain and will help you sort out dependencies. If building the database for the test suite fails - read the backtrace and look for the migration that caused the failure and then add the correct <a href="http://south.aeracode.org/docs/dependencies.html">dependencies code</a> - depends_on / needed_by to the failing migrations.</p>
<h3>Circuluar Migrations</h3>
<p>Depending on your database structure you might end up with a migration chain that can&#8217;t be fulfilled due to a circular dependency. I found that we had a couple of instances of Many To Many database tables being created in the initial migrations and those tables relying on one of the tables being created first. So to fix I removed the M2M migrations into their own migration and this cleared the circular dependency.</p>
<h3>A word about fixtures</h3>
<p>Fixtures can be brilliant and save loads of time, however they bypass the frozen orm and use the schema of the actual model - this can be painful when the model changes in the future. An simple work round I&#8217;ve used in the past has been something like: <a href="http://gist.github.com/623725">abusing fixtures in migrations</a>. That worked until I reset the migrations back to a clean state.</p>
<h2>Pushing Live</h2>
<p>Make sure all the old migrations have been run and you aren&#8217;t introducing any schema changes with the new migrations - do that before or after you&#8217;ve reset the migrations <em>but not at the same time</em>.</p>
<h3>Reset old migrations:</h3>
<p>Its simple just mark all the migrations as fake:</p>
<div class="CodeRay">
  <div class="code"><pre>./manage.py migrate --all --fake --delete-ghost-migrations</pre></div>
</div>

<p>That <em>should work</em>, but this step failed for me saying one initial was applied before its dependency (even though I was faking them.). However, as I was happy with the migration chain - thanks to my trusty test suite I just killed my migration history like so:</p>
<p>&nbsp;</p>
<div class="CodeRay">
  <div class="code"><pre>from south.models import MigrationHistory
MigrationHistory.objects.all().delete()</pre></div>
</div>

<p>&nbsp;</p>
<p>Then I marked all the migrations as fake:</p>
<div class="CodeRay">
  <div class="code"><pre>./manage.py migrate --all --fake</pre></div>
</div>

<p>All done!</p>

  
  


    </article>
  
  
    <article class="post">
      <div class="sharing-box">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://rozza.github.com/blog/page/8/index.html" data-via="RossC0" data-counturl="http://rozza.github.com/blog/page/8/index.html" data-size="large">Tweet</a>
  
  
  
</div>

      
  <header>
    
      <h2 class="entry-title">
        
        <a href="/2010-using-django-to-serve-parts-of-your.h/">Using Django to Serve Parts of Your Site Over HTTPS</a>
        
      </h2>
    
    
      <p class="meta">
        








  


<time datetime="2010-08-19T00:00:00+00:00" pubdate data-updated="true">Aug 19<span>th</span>, 2010</time>
        
      </p>
    
  </header>


  <p>Firstly, you&#8217;ll need to get your web server up and running with https, you&#8217;ll needyour certificate and key set up, happily theres already loads of posts about that,so I won&#8217;t cover it here!</p>
<p>The second area of pain is that djangos development runserver doesn&#8217;t support HTTPS,which is irksome but apparently there are ways around it! The <a href="http://code.google.com/p/django-weave/wiki/HTTPSDevelopment">django-weave</a> projectgo into detail about it.  I&#8217;m lucky in that I run vm&#8217;s to mimic my production environment, but I often use runserver as well as its just plain handy.</p>
<p>To serve parts of the site as HTTPS I just decorate the views and check the    `is_secure()` flag.  Then I redirect to the secure version!</p>
<p><script src="https://gist.github.com/537450.js?file=secure_required.py"></script></p>
<p>Simple stuff, but part of the problem is the url template tag does local urls,    so once they are on HTTPS how do we ensure that they use HTTP for other parts    of the site? To do this I use a middleware that checks for the flag set on the    request in the decorator:</p>
<p><script src="https://gist.github.com/537457.js?file=secure_required_middleware.py"></script></p>
<p>That ensures that I go back to HTTP versions of pages that should be served by    HTTP.</p>
<p>A final pain is managing mixed content type warnings, which happens when a    web page is served via HTTPS but the assets are served by HTTP, this is bad    as it could undermine the security of the whole page - so dont do it!    You&#8217;ll need to handle it so you&#8217;ll have to add checks like:</p>
<div class="CodeRay">
  <div class="code"><pre>http</pre></div>
</div>

<p>Make it easy by writing a template tag to do it and don&#8217;t forget and js widgets like addthis!</p>
<p>&nbsp;</p>
<div class="blogger-post-footer"><img class="posterous_download_image" src="https://blogger.googleusercontent.com/tracker/7305662280706773984-5991303057497360098?l=www.rosslawley.co.uk" height="1" alt="" width="1" /></div>

  
  


    </article>
  
  
    <article class="post">
      <div class="sharing-box">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://rozza.github.com/blog/page/8/index.html" data-via="RossC0" data-counturl="http://rozza.github.com/blog/page/8/index.html" data-size="large">Tweet</a>
  
  
  
</div>

      
  <header>
    
      <h2 class="entry-title">
        
        <a href="/2010-how-to-configure-vm-fusion-nat-to-be./">How to Configure VM Fusion NAT to Be Visible on Port 80 of the Host</a>
        
      </h2>
    
    
      <p class="meta">
        








  


<time datetime="2010-08-13T00:00:00+00:00" pubdate data-updated="true">Aug 13<span>th</span>, 2010</time>
        
      </p>
    
  </header>


  <p>I do <em>all</em> my development on VMWares, as they are cheap and easy to setup and mimic the real deployment environment.  I&#8217;ve always used NAT networking on my vmwares rather than put them on the network as standalone bridged items, however, recently I was asked to &#8220;share&#8221; my latest code on the network.  My host hacks didn&#8217;t get translated so I needed to to forward the port 80 traffic from the Mac to the VM</p>
<p>Turns out its easy - <a href="http://www.virtuatopia.com/index.php/VMware_Server_NAT_Configuration#.5Bincomingtcp.5D">nat.conf</a> is the key. Just add the configuration to</p>
<div class="CodeRay">
  <div class="code"><pre>/Library/Application\ Support/VMware\ Fusion/vmnet8/nat.conf</pre></div>
</div>

<p>in the incomingtcp configuration.</p>
<div class="CodeRay">
  <div class="code"><pre>[incomingtcp]
80 = IP_OF_THE_VMWARE:80</pre></div>
</div>

<p>And restart the vmware networking:</p>
<div class="CodeRay">
  <div class="code"><pre>sudo /Library/Application\ Support/VMware\ Fusion/boot.sh --restart</pre></div>
</div>

<p>&nbsp;</p>
<div class="blogger-post-footer"><img class="posterous_download_image" src="https://blogger.googleusercontent.com/tracker/7305662280706773984-3350553347337058838?l=www.rosslawley.co.uk" height="1" alt="" width="1" /></div>

  
  


    </article>
  

    <nav role="navigation" id="pagination">
  <span class="next">
    <a href="/blog/page/9/" rel="next">Continue &rarr;</a>
  </span>


  <span class="prev">
    <a href="/blog/page/7/" rel="prev">Newer &larr;</a>
  </span>

</nav>
  </section>
  

  

<script type="text/javascript">
      var disqus_shortname = 'rozza';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>




</body>
</html>
